<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ì¼ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }
        .card {
            margin-top: 10px;
            position: relative;
        }
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-center mb-4">ë‚˜ë§Œì˜ ì¼ê¸°</h1>

        <!-- ì¼ê¸° ì‘ì„± í¼ -->
        <div class="mb-3">
            <label for="diaryTitle" class="form-label">ì œëª©</label>
            <input type="text" class="form-control" id="diaryTitle" placeholder="ì¼ê¸° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="mb-3">
            <label for="diaryContent" class="form-label">ë‚´ìš©</label>
            <div id="diaryContent" class="form-control" style="height: 200px;"></div>
        </div>
        <button class="btn btn-primary" id="saveButton">ì €ì¥</button>

        <!-- ì €ì¥ëœ ì¼ê¸° ëª©ë¡ -->
        <div id="diaryList" class="mt-4"></div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ìˆœì„œ ì¡°ì • -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Firebase SDK and Firestore -->
    <script type="module">
        // Firebase ëª¨ë“ˆ ë° Firestore ê°€ì ¸ì˜¤ê¸°
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

        // Firebase êµ¬ì„± ë° ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyCFSvW2F-qG9f8opWYo5Q3570I-ARHzN9Y",
            authDomain: "mydiary-edf79.firebaseapp.com",
            projectId: "mydiary-edf79",
            storageBucket: "mydiary-edf79.appspot.com",
            messagingSenderId: "517169265201",
            appId: "1:517169265201:web:4b2f8d458822639ad8f310"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // WYSIWYG ì—ë””í„° ì´ˆê¸°í™”
        const quill = new Quill('#diaryContent', {
            theme: 'snow'
        });

        // ì¼ê¸° ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('saveButton').addEventListener('click', async function() {
            const title = document.getElementById('diaryTitle').value;
            const content = quill.root.innerHTML;
            const date = new Date().toLocaleDateString();

            if (title === "" || content === "<p><br></p>") {
                Swal.fire('ê²½ê³ ', 'ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'warning');
                return;
            }

            // Firestoreì— ì¼ê¸° ë°ì´í„° ì €ì¥
            try {
                await addDoc(collection(db, "diaryEntries"), {
                    title: title,
                    content: content,
                    date: date
                });

                Swal.fire('ì„±ê³µ', 'ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadDiaryEntries();
            } catch (error) {
                Swal.fire('ì—ëŸ¬', 'ì¼ê¸°ë¥¼ ì €ì¥í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }

            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            document.getElementById('diaryTitle').value = "";
            quill.root.innerHTML = "";
        });

        // Firestoreì—ì„œ ì¼ê¸° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadDiaryEntries() {
            const querySnapshot = await getDocs(collection(db, "diaryEntries"));
            const diaryEntries = [];
            querySnapshot.forEach((doc) => {
                diaryEntries.push({ id: doc.id, ...doc.data() });
            });

            updateDiaryList(diaryEntries);
        }

        // ì¼ê¸° ëª©ë¡ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDiaryList(diaryEntries) {
            const diaryList = document.getElementById('diaryList');
            diaryList.innerHTML = "";

            diaryEntries.forEach(function(entry) {
                const card = document.createElement('div');
                card.classList.add('card');
                card.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title">${entry.title}</h5>
                        <p class="card-text">${entry.date}</p>
                        <span class="delete-btn text-danger">ğŸ—‘ï¸ ì‚­ì œ</span>
                    </div>
                `;

                // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ - ì¼ê¸° ë‚´ìš© ë³´ê¸°
                card.querySelector('.card-title').addEventListener('click', function() {
                    Swal.fire({
                        title: entry.title,
                        html: entry.content,
                        confirmButtonText: 'ë‹«ê¸°'
                    });
                });

                // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ - ì¼ê¸° ì‚­ì œ
                card.querySelector('.delete-btn').addEventListener('click', async function() {
                    try {
                        await deleteDoc(doc(db, "diaryEntries", entry.id));
                        Swal.fire('ì‚­ì œ ì™„ë£Œ', 'ì¼ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                        loadDiaryEntries();
                    } catch (error) {
                        Swal.fire('ì—ëŸ¬', 'ì¼ê¸°ë¥¼ ì‚­ì œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                });

                diaryList.appendChild(card);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¼ê¸° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        loadDiaryEntries();
    </script>
</body>
</html>
